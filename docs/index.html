<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>Wealthica Example Add-on</title>
  <style>
    body { margin: 0; padding: 0; }
  </style>
  <script type="text/javascript" src="https://wealthica.github.io/wealthica.js/dist/addon.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
</head>
<body>
  <h3>Welcome to the "Are you Wealthier then Paolo?" Add-on</h3>
  <p>
    <button type="button" disabled="disabled" id="show">Show me!</button>
    <p id="richer"></p>
  </p>

  <script type="text/javascript">
    var addon, addonOptions;

    $(function () {
      addon = new Addon();
      window.addon = addon

      addon.on('init', function (options) {
        // Dashboard is ready and is signaling to the add-on that it should
        // render using the passed in options (filters, language, etc.)
        addonOptions = options;
        $('button').removeAttr('disabled');
        showAddonData(addonOptions.data, true);
      }).on('update', function (options) {
        // Filters have been updated and Dashboard is passing in updated options
        addonOptions = _.extend(addonOptions, options);
        showAddonData(addonOptions.data);
      });

      $('#show').on('click', () => {
        addon.api.getPositions().then(result => {
          total = result.reduce((total, item) => total + item.book_value, 0)
          let text = ""
          if (total < 2000000)
            text = `Lolz! You think you can out-wealth Paolo with a measly ${total}? Thank you, come again!`
          else
            text = "Yes. yes you are!"

          $("#richer").text = text;
        })
      })
      $(this).removeAttr('disabled');

      // Compose a query object from the addon options to pass to the API calls.
      function getQueryFromOptions (options) {
        return {
          from: options.dateRangeFilter && options.dateRangeFilter[0],
          to: options.dateRangeFilter && options.dateRangeFilter[1],
          groups: options.groupsFilter,
          institutions: options.institutionsFilter,
          investments: options.investmentsFilter === 'all' ? null: options.investmentsFilter,
        }
      }
    });
  </script>

</body>
</html>
